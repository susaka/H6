$CurrentScopes = Get-DHCPserverV4Scope
$changed = $false

{% for scope in scope1.vlans %}
if ($CurrentScopes -ne scope1.subnet)
{
$startRange = scope.subnet.substring(0,scope.subnet.length-4) + "5"
$slutrange = scope.subnet.substring(0,scope.subnet.length-4) + "254"
$gateway = scope.subnet.substring(0,scope.subnet.length-4) + "1"

Add-DhcpServerv4Scope -Name {{ scope }} -StartRange {{ "$startRange" }} -EndRange {{  "$slutrange" }}  -SubnetMask {{ "255.255.255.0" }} -State Active
Set-DHCPServerv4OptionValue -ScopeName {{ scope }} -DnsServer {{ "10.255.0.10" }} -Router {{ "$gateway" }}

$changed = $true
}
{% endfor %}

{% for scope in scope2.vlans %}
if ($CurrentScopes -ne scope2.subnet)
{
$startRange = scope.subnet.substring(0,scope.subnet.length-4) + "5"
$slutrange = scope.subnet.substring(0,scope.subnet.length-4) + "254"
$gateway = scope.subnet.substring(0,scope.subnet.length-4) + "1"

Add-DhcpServerv4Scope -Name {{ scope }} -StartRange {{ "$startRange" }} -EndRange {{  "$slutrange" }} -SubnetMask {{ "255.255.255.0" }} -State Active
Set-DHCPServerv4OptionValue -ScopeName {{ scope2 }} -DnsServer {{ "10.255.0.10" }} -Router {{ "$gateway" }}

$changed = $true
}
{% endfor %}

echo $changed

{# Inspiration hentet fra https://kontrolissues.net/2016/07/24/jinja2-and-powershell-automationish-microsoft-dhcp/ #}